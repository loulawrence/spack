<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" 
	 xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">
	<Fragment>
		<DirectoryRef Id="TARGETDIR">
			<Directory Id="DesktopFolder" Name="Desktop" />
			<Directory Id="ProgramMenuFolder" Name="Programs">
				<Directory Id="APPLICATIONFOLDER" Name="Spack">
					<Component Id="ProgramMenuDir" Guid="*">
						<RegistryValue Root="HKMU" Key="Software\LLNL\Spack"
								 Type="integer" Value="1" Name="installed" KeyPath="yes" />
						<RemoveFolder On="uninstall" Id="ProgramMenuDir"/>
						<util:RemoveFolderEx On="uninstall" Property="APPLICATIONFOLDER"/>
					</Component>
				</Directory>
			</Directory>
		</DirectoryRef>
	</Fragment>
	<Fragment>
		<Property Id="APPLICATIONFOLDER">
			<RegistrySearch Key="SOFTWARE\LLNL\Spack" Root="HKCU"
							Type="raw" Id="APPLICATIONFOLDER_REGSEARCH"
							Name="Path" />
		</Property>
	</Fragment>
	<Fragment>
		<DirectoryRef Id="APPLICATIONFOLDER">
			<Component Id="CleanupApplicationFolder" Guid="*">
				<RegistryValue Root="HKCU" Key="SOFTWARE\LLNL\Spack" Name="Path"
							   Type="string" Value="[APPLICATIONFOLDER]" KeyPath="yes" />
				<util:RemoveFolderEx On="uninstall" Property="APPLICATIONFOLDER" />
			</Component>
		</DirectoryRef>
	</Fragment>
	<Fragment>
		<Icon Id="icon.ico" SourceFile="@CPACK_WIX_PRODUCT_ICON@"/>
		<Property Id="ARPPRODUCTICON" Value="icon.ico" />
	</Fragment>
	<Fragment>
		<!-- Add the shortcut to installer package -->
		<ComponentGroup Id="ProductComponents" Directory="INSTALL_ROOT">
			<Component Id="ApplicationShortcut" Guid="*">
				<File Source="@SPACK_SHORTCUT@" KeyPath="yes">
					<Shortcut Id="SpackStartMenuShortcut"
						  Directory="DesktopFolder"
						  Advertise="yes"
						  Name="Spack Package Manager"
						  Description="Spack package manager"
						  WorkingDirectory="INSTALL_ROOT"
						  Icon="icon1.ico">
						<Icon Id="icon1.ico" SourceFile="@CPACK_WIX_PRODUCT_ICON@" />
					</Shortcut>
					<Shortcut Id="startMenuShotcut"
						  Directory="APPLICATIONFOLDER"
						  Name="Spack Package Manager"
						  WorkingDirectory="INSTALL_ROOT"
						  Icon="icon2.ico"
						  IconIndex="0"
						  Advertise="yes">
						<Icon Id="icon2.ico" SourceFile="@CPACK_WIX_PRODUCT_ICON@" />
					</Shortcut>
				</File>
			</Component>
		</ComponentGroup>
	</Fragment>
</Wix>